<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Voucher – Grupo DV</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<style>

/* ============================ */
/*        TEMA PREMIUM          */
/* ============================ */
:root{
  --bg:#0a0a0a;
  --card:#151515;
  --gold:#d4af37;
  --gold2:#b88e1a;
  --white:#f5f5f5;
  --radius:14px;
  --shadow:0 6px 18px rgba(0,0,0,.45);
}

/* ============================ */
/*        BASE GERAL            */
/* ============================ */
body{
  margin:0;
  background:var(--bg);
  font-family:'Inter',sans-serif;
  color:white;
  -webkit-tap-highlight-color:transparent;
  overflow-x:hidden;
}

.screen{
  display:none;
  padding:20px;
  animation:fade .25s ease;
}
.screen.active{ display:block; }

@keyframes fade{ from{opacity:.2;} to{opacity:1;} }

/* ============================ */
/*    TITULOS E SUBTITULOS      */
/* ============================ */
.title{
  text-align:center;
  font-size:20px;
  color:var(--gold);
  font-weight:700;
  margin-bottom:6px;
}
.subtitle{
  text-align:center;
  font-size:13px;
  color:#bbb;
  margin-bottom:18px;
}

/* ============================ */
/*            BOTÕES            */
/* ============================ */
.btn{
  width:100%;
  padding:12px;
  margin-top:16px;
  font-size:16px;
  font-weight:700;
  border:none;
  border-radius:var(--radius);
  background:var(--gold);
  color:black;
}
.btn:hover{ background:var(--gold2); }

.btnBack{
  background:#444;
  color:white;
}

/* ============================ */
/*           CAMPOS             */
/* ============================ */
input, select{
  width:100%;
  padding:11px;
  margin-top:14px;
  background:var(--card);
  border:2px solid var(--gold);
  border-radius:var(--radius);
  font-size:15px;
  color:white;
  outline:none;
}

/* ============================ */
/*            VALORES           */
/* ============================ */
.values{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}

.cardValor{
  background:var(--card);
  border:2px solid var(--gold);
  border-radius:var(--radius);
  padding:14px 0;
  text-align:center;
  font-size:18px;
  font-weight:600;
  cursor:pointer;
  transition:.25s;
}
.cardValor:hover{ background:#222; }
.cardValor.sel{
  background:var(--gold);
  color:black;
}

/* ============================ */
/*         CAIXA RESUMO         */
/* ============================ */
.box{
  background:var(--card);
  padding:16px;
  border-radius:var(--radius);
  border:2px solid var(--gold);
  box-shadow:var(--shadow);
  margin-bottom:16px;
}
.box h3{
  text-align:center;
  margin:0 0 10px;
  color:var(--gold);
}
.line{
  font-size:15px;
  margin-bottom:5px;
}

/* ============================ */
/*       OVERLAY LOADING        */
/* ============================ */
.overlay{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,.75);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:999;
}
.loader{
  width:55px;
  height:55px;
  border:5px solid var(--gold2);
  border-top-color:var(--gold);
  border-radius:50%;
  animation:spin .8s linear infinite;
}
@keyframes spin{ to{ transform:rotate(360deg);} }

</style>
</head>
<body>

<!-- ========================= -->
<!--   OVERLAY LOADING         -->
<!-- ========================= -->
<div class="overlay" id="overlay">
  <div class="loader"></div>
</div>

<!-- ========================= -->
<!--    TELA 1 — VALOR         -->
<!-- ========================= -->
<div class="screen active" id="t1">
  <div class="title">1º Passo</div>
  <div class="subtitle">Escolha o valor do voucher</div>

  <div class="values">
    <div class="cardValor" onclick="selectValor(50)">R$ 50</div>
    <div class="cardValor" onclick="selectValor(80)">R$ 80</div>
    <div class="cardValor" onclick="selectValor(100)">R$ 100</div>
    <div class="cardValor" onclick="selectValor(150)">R$ 150</div>
    <div class="cardValor" onclick="selectValor(200)">R$ 200</div>
    <div class="cardValor" onclick="show('t1b')">Outro</div>
  </div>
</div>

<!-- ========================= -->
<!--   TELA 1b — OUTRO VALOR   -->
<!-- ========================= -->
<div class="screen" id="t1b">
  <div class="title">Informe o valor</div>
  <input id="outroValor" inputmode="numeric" oninput="maskValor(this)">
  <button class="btn" onclick="confirmarOutro()">Confirmar</button>
  <button class="btn btnBack" onclick="show('t1')">Voltar</button>
</div>

<!-- ========================= -->
<!--     TELA 2 — DADOS        -->
<!-- ========================= -->
<div class="screen" id="t2">
  <div class="title">2º Passo</div>
  <div class="subtitle">Preencha seus dados</div>

  <input id="nome" placeholder="Nome completo">
  <input id="whats" inputmode="numeric" placeholder="WhatsApp" oninput="maskWhats(this)">
  <input id="emailComprador" placeholder="Seu e-mail">

  <select id="presente" onchange="togglePresente()">
    <option value="">É presente?</option>
    <option value="nao">Não</option>
    <option value="sim">Sim</option>
  </select>

  <input id="emailPresente" placeholder="Email do presenteado" style="display:none;">

  <button class="btn" onclick="validateT2()">Avançar</button>
  <button class="btn btnBack" onclick="show('t1')">Voltar</button>
</div>

<!-- ========================= -->
<!--     TELA 3 — REVISÃO      -->
<!-- ========================= -->
<div class="screen" id="t3">
  <div class="title">3º Passo</div>
  <div class="subtitle">Revise suas informações</div>

  <div class="box">
    <h3>Resumo</h3>
    <div class="line" id="r_valor"></div>
    <div class="line" id="r_nome"></div>
    <div class="line" id="r_email"></div>
    <div class="line" id="r_presente"></div>
  </div>

  <button class="btn" onclick="registrarVoucher()">Enviar e Realizar Pagamento</button>
  <button class="btn btnBack" onclick="show('t2')">Voltar</button>
</div>

<!-- ========================= -->
<!--     TELA 4 — PIX          -->
<!-- ========================= -->
<div class="screen" id="t4">
  <div class="title">Pagamento PIX</div>

  <div class="box">
    <h3>Voucher Registrado</h3>
    <div class="line">Realize o pagamento para ativar o voucher.</div>
    <div class="line" id="resumoEmails"></div>
  </div>

  <div class="box">
    <h3>CHAVE PIX</h3>
    <div class="line" id="pixCode">SUA_CHAVE_PIX_AQUI</div>
    <button class="btn" onclick="copyPix()">Copiar</button>
  </div>

  <button class="btn btnBack" onclick="resetAll()">Voltar ao início</button>
</div>

<script>

let valor = 0;

/* --------------------------
      CONTROLE DE TELAS
--------------------------- */
function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* --------------------------
        SELEÇÃO VALOR
--------------------------- */
function selectValor(v){
  valor = v;
  document.querySelectorAll('.cardValor').forEach(c=>c.classList.remove('sel'));
  event.target.classList.add('sel');
  show('t2');
}

function maskValor(i){
  let v = i.value.replace(/\D/g,"");
  v = (v/100).toFixed(2).replace('.',',');
  i.value = "R$ "+v;
}

function confirmarOutro(){
  let v = document.getElementById("outroValor").value;
  valor = Number(v.replace(/\D/g,""))/100;
  show('t2');
}

/* --------------------------
       DADOS / PRESENTE
--------------------------- */
function togglePresente(){
  document.getElementById("emailPresente").style.display =
    document.getElementById("presente").value==="sim" ? "block" : "none";
}

function maskWhats(i){
  let v = i.value.replace(/\D/g,"");

  if(v.length > 11) v = v.slice(0,11);

  v = v.replace(/^(\d{2})(\d)/,"($1) $2");
  v = v.replace(/(\d{5})(\d)/,"$1-$2");

  i.value = v;
}

/* --------------------------
         VALIDAR TELA 2
--------------------------- */
function validateT2(){
  if(!nome.value || !whats.value || !emailComprador.value){
    alert("Preencha todos os campos.");
    return;
  }

  r_valor.innerHTML = "<b>Valor:</b> R$ "+valor.toFixed(2).replace('.',',');
  r_nome.innerHTML = "<b>Nome:</b> "+nome.value;
  r_email.innerHTML = "<b>Email:</b> "+emailComprador.value;

  if(presente.value==="sim"){
    r_presente.innerHTML = "<b>Presente para:</b> "+emailPresente.value;
  } else r_presente.innerHTML = "";

  show('t3');
}

/* --------------------------
        REGISTRAR NO GAS
--------------------------- */
function registrarVoucher(){

  document.getElementById("overlay").style.display="flex";

  fetch("https://script.google.com/macros/s/AKfycbxqXaN_o3M5SkFsIdEEIHL2SdCSfxtE4TZRJTszFMt5qyjbvnCWAkFPoIE7X5B0YcwYdQ/exec",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      acao:"registrar",
      valor,
      nomeComprador:nome.value,
      emailComprador:emailComprador.value,
      whats:whats.value,
      presente:presente.value,
      emailPresente:emailPresente.value
    })
  })
  .then(r=>r.json())
  .then(res=>{

    document.getElementById("overlay").style.display="none";

    resumoEmails.innerHTML =
      "<b>E-mails cadastrados:</b><br>"+
      emailComprador.value+
      (presente.value==="sim"?"<br>"+emailPresente.value:"");

    show("t4");
  });
}

/* --------------------------
              PIX
--------------------------- */
function copyPix(){
  navigator.clipboard.writeText(pixCode.innerText);
  alert("Chave copiada!");
}

/* --------------------------
         RESET TOTAL
--------------------------- */
function resetAll(){ location.reload(); }

</script>

</body>
</html>
